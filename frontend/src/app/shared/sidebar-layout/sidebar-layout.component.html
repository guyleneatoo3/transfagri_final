<!-- Mobile top bar -->
<div class="md:hidden flex items-center justify-between p-3 bg-slate-900 text-white">
  <div class="flex items-center gap-2">
    <img src="assets/cnef.jpg" alt="CNEF" class="w-8 h-8 rounded" />
    <span class="font-semibold">Dashboard</span>
  </div>
  <button class="px-3 py-1 rounded bg-amber-400 text-slate-900" (click)="toggle()">Menu</button>
</div>

<div class="min-h-screen bg-[#f3f7fb] text-gray-800 md:flex relative">
  <!-- Sidebar (always dark, no white overlay) -->
  <aside class="bg-slate-900 text-white w-64 shrink-0 md:translate-x-0 md:static fixed inset-y-0 left-0 transform transition-transform duration-200 z-[60]"
         [class.-translate-x-full]="!sidebarOpen" [class.translate-x-0]="sidebarOpen">
    <div class="h-full flex flex-col">
      <div class="flex items-center gap-3 px-4 py-4 border-b border-white/10">
        <img src="assets/cnef.jpg" alt="CNEF" class="w-10 h-10 rounded" />
        <div>
          <div class="font-semibold tracking-wide">CNEF</div>
          <div class="text-xs text-white/70">BEAC</div>
        </div>
      </div>

      <!-- Role-based menu with icons -->
      <div>
        <!-- Common Dashboard entry -->
        <a [routerLink]="role==='ADMIN' ? '/dashboard/admin' : role==='CNEF' ? '/dashboard/cnef' : role==='EMF' ? '/dashboard/emf' : role==='PASNFI' ? '/dashboard/pasnfi' : '/accueil'"
           routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M4 10l8-6 8 6v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8Z"/></svg>
          Dashboard
        </a>
        <!-- Admin -->
        <ng-container *ngIf="role === 'ADMIN'">
          <a routerLink="/dashboard/admin/utilisateurs" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M15 14a5 5 0 1 0-6 0 7 7 0 0 0-6 6h2a5 5 0 0 1 10 0h2a7 7 0 0 0-6-6Z"/><path d="M12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></svg>
            Utilisateurs
          </a>
        </ng-container>

        <!-- CNEF -->
        <ng-container *ngIf="role === 'CNEF'">
          <a routerLink="/dashboard/cnef/emf" routerLinkActive="bg-black/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z"/></svg>
            Gérer les EMF
          </a>
          <a routerLink="/dashboard/cnef/formation" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M6 2h9l5 5v15H6V2Zm9 1.5V8h4.5"/></svg>
            Téléverser des formations
          </a>
          <a routerLink="/dashboard/cnef/indicateurs" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M3 3h18v2H3V3Zm2 5h14v2H5V8Zm-2 5h18v2H3v-2Zm2 5h14v2H5v-2Z"/></svg>
            Indicateurs
          </a>
          <a routerLink="/dashboard/cnef/tendances" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M4 19h16v2H4v-2Zm2-4h12v2H6v-2Zm2-4h8v2H8V11Zm2-4h4v2h-4V7Z"/></svg>
            Tendances
          </a>
          <a routerLink="/dashboard/cnef/questionnaires" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M6 4h12a2 2 0 0 1 2 2v12l-4-2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z"/></svg>
            Questionnaires
          </a>
          <a routerLink="/dashboard/cnef/activites" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M4 3h16v2H4V3Zm0 4h10v2H4V7Zm0 4h16v2H4v-2Zm0 4h10v2H4v-2Z"/></svg>
            Activités
          </a>
        </ng-container>

        <!-- EMF -->
        <ng-container *ngIf="role === 'EMF'">
          <a routerLink="/dashboard/emf/questionnaire" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M5 3h14a2 2 0 0 1 2 2v14H3V5a2 2 0 0 1 2-2Zm3 6h8v2H8V9Zm0 4h8v2H8v-2Z"/></svg>
            Questionnaire
          </a>
          <a routerLink="/dashboard/emf/formations" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M4 4h16v2H4V4Zm0 4h16v2H4V8Zm0 4h10v2H4v-2Z"/></svg>
            Formations
          </a>
        </ng-container>

        <!-- PASNFI -->
        <ng-container *ngIf="role === 'PASNFI'">
          <a routerLink="/dashboard/pasnfi/rapports" routerLinkActive="bg-white/10" (click)="closeOnNav()" class="flex items-center gap-3 px-3 py-2 rounded hover:bg-white/10">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M6 2h9l5 5v15H6V2Zm9 1.5V8h4.5"/></svg>
            Rapports
          </a>
        </ng-container>
      
     </div>
      <div class="mt-auto p-3 text-sm text-white/70">Connecté: <span class="font-semibold">{{ role || 'Invité' }}</span></div>
    </div>
  </aside>

  <!-- Overlay mobile -->
  <div class="fixed inset-0 bg-black/30 z-[50] md:hidden" *ngIf="sidebarOpen" (click)="sidebarOpen=false"></div>

  <!-- Main content slot -->
  <main class="flex-1 min-w-0">
  <header class="hidden md:flex items-center justify-between bg-white shadow px-6 py-3 sticky top-0 z-40">
      <h1 class="text-2xl font-bold text-sky-700">Dashboard</h1>
      <div class="flex items-center gap-4 relative">
        <a routerLink="/accueil" class="text-gray-700 hover:text-sky-700">Accueil</a>
        <a routerLink="/apropos" class="text-gray-700 hover:text-sky-700">À propos</a>
        <a routerLink="/contact" class="text-gray-700 hover:text-sky-700">Contact</a>
        <a routerLink="/login" class="text-gray-700 hover:text-sky-700">Connexion</a>
        <input type="search" placeholder="Rechercher..." class="px-3 py-2 rounded border border-gray-200" />

        <!-- Avatar menu -->
        <button class="ml-4 flex items-center gap-2" (click)="toggleProfile()">
          <img src="assets/a.jpg" alt="avatar" class="w-8 h-8 rounded-full ring-2 ring-sky-100" />
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-slate-500"><path d="M6 9l6 6 6-6"/></svg>
        </button>
        <div *ngIf="profileOpen" class="absolute right-0 top-10 w-56 bg-white border border-slate-200 rounded-lg shadow-lg p-2">
          <a routerLink="/profile" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-slate-50">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm-7 9a7 7 0 0 1 14 0Z"/></svg>
            Mon profil
          </a>
          <a routerLink="/settings" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-slate-50">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M19.14 12.936a7.5 7.5 0 1 1-7.076-7.076 2 2 0 0 0 2.872 2.872 7.55 7.55 0 0 1 4.204 4.204Z"/></svg>
            Paramètres
          </a>
          <button (click)="logout()" class="w-full text-left flex items-center gap-2 px-3 py-2 rounded hover:bg-rose-50 text-rose-600">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M16 17v2H5V5h11v2h2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2v-2h-2Zm-1-7-4 4-2-2-1.5 1.5L11 17l5.5-5.5L15 10Z"/></svg>
            Déconnexion
          </button>
        </div>
      </div>
    </header>

  <section class="p-4 content-under-sidebar md:pt-6">
      <div class="max-w-7xl mx-auto">
        <ng-content></ng-content>
      </div>
    </section>
  </main>
</div>
