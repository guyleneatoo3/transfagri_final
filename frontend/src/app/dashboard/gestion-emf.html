<div class="rounded-2xl bg-white p-6 shadow-sm border border-slate-100">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <h2 class="text-xl md:text-2xl font-semibold text-slate-800">Gestion des EMF</h2>
    <div class="flex gap-2">
      <div class="relative">
        <input [(ngModel)]="searchTerm" (keyup.enter)="searchEmf()" placeholder="Rechercher un EMF..." class="w-64 rounded-lg border border-slate-300/70 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/60" />
        <span class="absolute right-2 top-1.5 text-slate-400 text-sm">⏎</span>
      </div>
      <button (click)="searchEmf()" class="inline-flex items-center gap-1 rounded-lg bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-700">Rechercher</button>
      <button (click)="clearSelection()" class="inline-flex items-center gap-1 rounded-lg bg-slate-100 px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-200">Réinitialiser</button>
    </div>
  </div>

  <div *ngIf="error" class="mt-2 text-sm text-red-600">{{ error }}</div>

  <div class="mt-5 rounded-xl border border-slate-200 overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-200">
      <thead class="bg-slate-50">
        <tr class="text-left text-xs font-semibold uppercase tracking-wider text-slate-500 sticky top-0">
          <th class="px-4 py-3">Dénomination</th>
          <th class="px-4 py-3">Localisation</th>
          <th class="px-4 py-3">Dirigeant</th>
          <th class="px-4 py-3">N° d'Agrément</th>
          <th class="px-4 py-3">N° CNC</th>
          <th class="px-4 py-3">Email</th>
          <th class="px-4 py-3">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100 bg-white">
        <tr *ngFor="let emf of emfs" class="hover:bg-slate-50/70">
          <td class="px-4 py-3 font-medium text-slate-800">{{ emf.denomination }}</td>
          <td class="px-4 py-3 text-slate-700">{{ emf.localisation }}</td>
          <td class="px-4 py-3 text-slate-700">{{ emf.dirigeant }}</td>
          <td class="px-4 py-3 text-slate-700">{{ emf.numeroDAgrement }}</td>
          <td class="px-4 py-3 text-slate-700">{{ emf.numeroCNC }}</td>
          <td class="px-4 py-3 text-slate-700">{{ emf.email }}</td>
          <td class="px-4 py-3">
            <div class="flex items-center gap-2">
              <button (click)="selectEmf(emf)" class="rounded-md border border-emerald-600/20 bg-emerald-50 px-3 py-1.5 text-xs font-medium text-emerald-700 hover:bg-emerald-100">Modifier</button>
              <button (click)="deleteEmf(emf)" class="rounded-md border border-red-600/20 bg-red-50 px-3 py-1.5 text-xs font-medium text-red-700 hover:bg-red-100">Supprimer</button>
            </div>
          </td>
        </tr>
        <tr *ngIf="!loading && emfs.length === 0">
          <td colspan="7" class="px-4 py-6 text-center text-sm text-slate-500">Aucun EMF trouvé</td>
        </tr>
        <tr *ngIf="loading">
          <td colspan="7" class="px-4 py-6 text-center text-sm text-slate-500">Chargement…</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Formulaires -->
  <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2">
    <!-- Ajout -->
    <div class="rounded-xl border border-slate-200 p-4">
      <h3 class="mb-3 text-base font-semibold text-slate-800">Ajouter un EMF</h3>
      <form (ngSubmit)="addEmf()" class="grid grid-cols-1 gap-3 md:grid-cols-2">
        <input [(ngModel)]="newEmf.denomination" name="denomination" placeholder="Dénomination" required class="input" />
        <input [(ngModel)]="newEmf.localisation" name="localisation" placeholder="Localisation" required class="input" />
        <input [(ngModel)]="newEmf.dirigeant" name="dirigeant" placeholder="Dirigeant" required class="input" />
        <input [(ngModel)]="newEmf.numeroDAgrement" name="numeroDAgrement" placeholder="Numéro d'Agrément" required class="input" />
        <input [(ngModel)]="newEmf.numeroCNC" name="numeroCNC" placeholder="Numéro CNC" required class="input" />
        <input [(ngModel)]="newEmf.email" name="email" placeholder="Email" required class="input" />
        <div class="md:col-span-2 mt-1">
          <button type="submit" class="rounded-lg bg-emerald-600 px-4 py-2 text-sm font-medium text-white hover:bg-emerald-700">Ajouter</button>
        </div>
      </form>
    </div>

    <!-- Edition -->
    <div class="rounded-xl border border-slate-200 p-4" *ngIf="isEditing">
      <h3 class="mb-3 text-base font-semibold text-slate-800">Modifier l'EMF</h3>
      <form (ngSubmit)="updateEmf()" class="grid grid-cols-1 gap-3 md:grid-cols-2">
        <input [(ngModel)]="selectedEmf!.denomination" name="denomination_edit" placeholder="Dénomination" required class="input" />
        <input [(ngModel)]="selectedEmf!.localisation" name="localisation_edit" placeholder="Localisation" required class="input" />
        <input [(ngModel)]="selectedEmf!.dirigeant" name="dirigeant_edit" placeholder="Dirigeant" required class="input" />
        <input [(ngModel)]="selectedEmf!.numeroDAgrement" name="numeroDAgrement_edit" placeholder="Numéro d'Agrément" required class="input" />
        <input [(ngModel)]="selectedEmf!.numeroCNC" name="numeroCNC_edit" placeholder="Numéro CNC" required class="input" />
        <input [(ngModel)]="selectedEmf!.email" name="email_edit" placeholder="Email" required class="input" />
        <div class="md:col-span-2 mt-1 flex items-center gap-2">
          <button type="submit" class="rounded-lg bg-emerald-600 px-4 py-2 text-sm font-medium text-white hover:bg-emerald-700">Mettre à jour</button>
          <button type="button" (click)="clearSelection()" class="rounded-lg bg-slate-100 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-200">Annuler</button>
        </div>
      </form>
    </div>
  </div>
</div>